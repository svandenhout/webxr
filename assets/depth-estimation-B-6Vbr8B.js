import{S as M,P as D,W as S,A as W,a as A,b as C,B as F,M as R,c as B,D as E}from"./ARButton-D_SEVJ6B.js";let z,w,s,t,P,c;H();function H(){z=document.createElement("div"),document.body.appendChild(z),s=new M,w=new D(70,window.innerWidth/window.innerHeight,.01,20),t=new S({antialias:!0,alpha:!0}),t.setPixelRatio(window.devicePixelRatio),t.setSize(window.innerWidth,window.innerHeight),t.setAnimationLoop(L),t.xr.enabled=!0,z.appendChild(t.domElement);const l=new W(16777215,1);s.add(l),document.body.appendChild(A.createButton(t,{requiredFeatures:["depth-sensing"],optionalFeatures:["hit-test","hand-tracking"],depthSensing:{usagePreference:["cpu-optimized","gpu-optimized"],dataFormatPreference:["luminance-alpha"]}})),P=t.xr.getController(0),s.add(P),window.addEventListener("resize",I)}function v(l,n,d,p=1){const a=new C(2,2,n-1,d-1),o=a.attributes.position.array,u=new Float32Array(o.length);let h=.01,m=5;for(let r=0;r<d;r++)for(let i=0;i<n;i++){const f=i/n,g=r/d;try{let e=l.getDepthInMeters(f,g);(!e||!isFinite(e))&&(e=2),h=Math.min(h,e),m=Math.max(m,e)}catch(e){console.error(`Error getting depth at (${i}, ${r}):`,e)}}for(let r=0;r<d;r++)for(let i=0;i<n;i++){const f=i/n,g=r/d;try{let e=l.getDepthInMeters(f,g);(!e||!isFinite(e))&&(e=m);const x=(e-h)/(m-h),y=(r*n+i)*3+2;o[y]=-e*p;const b=(r*n+i)*3;u[b]=x,u[b+1]=1-x,u[b+2]=1-x*.5}catch(e){console.error(`Error getting depth at (${i}, ${r}):`,e)}}return a.setAttribute("color",new F(u,3)),a.attributes.position.needsUpdate=!0,a.computeVertexNormals(),new R(a,new B({vertexColors:!0,side:E}))}function I(){w.aspect=window.innerWidth/window.innerHeight,w.updateProjectionMatrix(),t.setSize(window.innerWidth,window.innerHeight)}function L(l,n){if(!n||!t.xr.getSession())return;const p=t.xr.getReferenceSpace();if(!p)return;const a=n.getViewerPose(p);if(!a)return;const o=n.getDepthInformation(a.views[0]);o&&(c?(s.remove(c),c=v(o,o.width,o.height),s.add(c)):(c=v(o,o.width,o.height),s.add(c)),t.render(s,w))}
