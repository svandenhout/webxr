import{S as M,P as D,W as S,A,a as W,B as C,M as F,b as R,D as B}from"./three.module-DI-f1AAC.js";import{A as E}from"./ARButton-CkA1wH0C.js";let z,w,s,t,P,c;H();function H(){z=document.createElement("div"),document.body.appendChild(z),s=new M,w=new D(70,window.innerWidth/window.innerHeight,.01,20),t=new S({antialias:!0,alpha:!0}),t.setPixelRatio(window.devicePixelRatio),t.setSize(window.innerWidth,window.innerHeight),t.setAnimationLoop(L),t.xr.enabled=!0,z.appendChild(t.domElement);const l=new A(16777215,1);s.add(l),document.body.appendChild(E.createButton(t,{requiredFeatures:["depth-sensing"],optionalFeatures:["hit-test","hand-tracking"],depthSensing:{usagePreference:["cpu-optimized","gpu-optimized"],dataFormatPreference:["luminance-alpha"]}})),P=t.xr.getController(0),s.add(P),window.addEventListener("resize",I)}function v(l,n,d,p=1){const a=new W(2,2,n-1,d-1),o=a.attributes.position.array,u=new Float32Array(o.length);let m=.01,h=5;for(let r=0;r<d;r++)for(let i=0;i<n;i++){const f=i/n,g=r/d;try{let e=l.getDepthInMeters(f,g);(!e||!isFinite(e))&&(e=2),m=Math.min(m,e),h=Math.max(h,e)}catch(e){console.error(`Error getting depth at (${i}, ${r}):`,e)}}for(let r=0;r<d;r++)for(let i=0;i<n;i++){const f=i/n,g=r/d;try{let e=l.getDepthInMeters(f,g);(!e||!isFinite(e))&&(e=h);const x=(e-m)/(h-m),y=(r*n+i)*3+2;o[y]=-e*p;const b=(r*n+i)*3;u[b]=x,u[b+1]=1-x,u[b+2]=1-x*.5}catch(e){console.error(`Error getting depth at (${i}, ${r}):`,e)}}return a.setAttribute("color",new C(u,3)),a.attributes.position.needsUpdate=!0,a.computeVertexNormals(),new F(a,new R({vertexColors:!0,side:B}))}function I(){w.aspect=window.innerWidth/window.innerHeight,w.updateProjectionMatrix(),t.setSize(window.innerWidth,window.innerHeight)}function L(l,n){if(!n||!t.xr.getSession())return;const p=t.xr.getReferenceSpace();if(!p)return;const a=n.getViewerPose(p);if(!a)return;const o=n.getDepthInformation(a.views[0]);o&&(c?(s.remove(c),c=v(o,o.width,o.height),s.add(c)):(c=v(o,o.width,o.height),s.add(c)),t.render(s,w))}
