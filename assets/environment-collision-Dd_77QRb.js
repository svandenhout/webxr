import{S as x,P as M,H as P,W as S,C as R,c as W,M as v,d as u,V as y}from"./three.module-DI-f1AAC.js";import{A as z}from"./ARButton-CkA1wH0C.js";let p,s,a,e,w,c,d=null;C();function C(){p=document.createElement("div"),document.body.appendChild(p),a=new x,s=new M(70,window.innerWidth/window.innerHeight,.01,20);const l=new P(16777215,12303359,3);l.position.set(.5,1,.25),a.add(l),e=new S({antialias:!0,alpha:!0}),e.setPixelRatio(window.devicePixelRatio),e.setSize(window.innerWidth,window.innerHeight),e.setAnimationLoop(L),e.xr.enabled=!0,p.appendChild(e.domElement),e.xr.addEventListener("sessionstart",async()=>{const i=e.xr.getSession();if(!i)return;const n=await i.requestReferenceSpace("viewer");n&&(i.requestHitTestSource({space:n}).then(o=>{d=o,console.log("HitTestSource initialized:",d)}),i.addEventListener("end",()=>{d=null}))}),document.body.appendChild(z.createButton(e,{requiredFeatures:["hit-test","depth-sensing"],depthSensing:{usagePreference:["cpu-optimized","gpu-optimized"],dataFormatPreference:["luminance-alpha"]}}));const t=new R(.1,.1,.2,32).translate(0,.1,0),r=new W({color:16777215*Math.random()});c=new v(t,r),a.add(c),w=e.xr.getController(0),a.add(w),window.addEventListener("resize",H)}function H(){s.aspect=window.innerWidth/window.innerHeight,s.updateProjectionMatrix(),e.setSize(window.innerWidth,window.innerHeight)}function E(l,t,r,i=.1){if(!r)return;const n=new y;n.setFromMatrixPosition(t.matrixWorld),n.project(s);const o=(n.x+1)/2,m=1-(n.y+1)/2,f=Math.min(Math.max(o,0),1),g=Math.min(Math.max(m,0),1);try{const h=r.getDepthInMeters(f,g);return t.position.distanceTo(s.position)>h+i?(console.log("Collision Detected!"),t.material.color.set(16711680),!0):(t.material.color.set(65280),!1)}catch(h){console.error("Error getting depth for collision check:",h)}}function L(l,t){if(!t)return;const r=e.xr.getReferenceSpace();if(!r||!d)return;const i=t.getHitTestResults(d),n=t.getViewerPose(r);if(!n)return;const o=t.getDepthInformation(n.views[0]);if(o){if(i.length>0){const m=i[0].getPose(r);E(t,c,o)||(c.position.setFromMatrixPosition(new u().fromArray(m.transform.matrix)),c.quaternion.setFromRotationMatrix(new u().fromArray(m.transform.matrix)))}e.render(a,s)}}
